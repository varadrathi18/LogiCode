<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spanish Intermediate Quiz Q3</title>
  <link rel="stylesheet" href="audio-quiz.css" />
  <style>
    .sentence-prompt { font-size: 1.23rem; margin-bottom: 18px; color: #135dc1; font-weight: 700; text-align: center; }
    .word-tiles { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 16px; }
    .word-tile {
      background: linear-gradient(135deg, #b3e0fe, #fbc2eb 70%);
      border: 2px solid #38bdd0;
      border-radius: 20px;
      padding: 12px 20px;
      font-size: 1.01rem;
      font-weight: 600;
      color: #174da1;
      cursor: pointer;
      transition: background .16s, box-shadow .18s;
      box-shadow: 0 2px 12px #135dc12a;
      user-select: none;
    }
    .word-tile:hover { background: linear-gradient(135deg, #9fd1ff, #f8d4ee); }
    .word-tile.used {
      background: #d4f7e6;
      color: #535381;
      opacity: 0.6;
      pointer-events: none;
    }
    .sentence-build-box {
      min-height: 40px;
      background: #f8f9fa;
      border-radius: 14px;
      padding: 16px;
      font-size: 1.18rem;
      margin-bottom: 18px;
      text-align: center;
    }
    .sentence-output-word {
      margin-right: 8px;
      font-weight: 650;
      color: #134dc1;
    }
    .sentence-actions {
      margin-top: 10px;
      text-align: center;
    }
    .sentence-actions button {
      margin: 0 8px;
      font-size: 1rem;
      border-radius: 9px;
      padding: 8px 20px;
      background: #38bdd0;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background .2s;
    }
    .sentence-actions button:hover {
      background: #2b9cad;
    }
  </style>
</head>
<body>
  <div class="quiz-bg">
    <div class="quiz-topbar">
      <div class="quiz-progress">
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot active"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
        <div class="progress-dot"></div>
      </div>
      <div class="status-info">
        <div class="item"><img src="../lives.png" alt="Lives" /><span id="lives-count"></span></div>
        <div class="item"><img src="../points2.png" alt="Points" /><span id="points-count"></span></div>
      </div>
    </div>

    <div class="quiz-content">
      <div class="sentence-prompt">Arrange the words to translate: <b>Estoy leyendo un libro</b></div>
      <div class="word-tiles" id="word-bank"></div>
      <div class="sentence-build-box" id="sentence-box"></div>
      <div class="sentence-actions">
        <button id="reset-btn">Reset</button>
        <button id="submit-btn">Check</button>
      </div>
    </div>

    <div id="popup-zone"></div>
  </div>

<script>
  const correctSentence = ["I", "am", "reading", "a", "book"];
  const wordOptions = ["I", "book", "reading", "am", "a", "interesting", "now"];

  // Continue from Spanish Beginner
  const STORAGE_PREFIX = "sp-beginner-";

  const wordBank = document.getElementById('word-bank');
  const sentenceBox = document.getElementById('sentence-box');
  let currentSentence = [], usedIndices = [];

  function updateStatusBar() {
  document.getElementById('lives-count').textContent = localStorage.getItem('quizLives') || '5';
  document.getElementById('points-count').textContent = localStorage.getItem('quizPoints') || '0';
  }
  updateStatusBar();

  function renderWordBank() {
    wordBank.innerHTML = '';
    wordOptions.forEach((word, idx) => {
      const tile = document.createElement('div');
      tile.className = 'word-tile' + (usedIndices.includes(idx) ? ' used' : '');
      tile.textContent = word;
      if (!usedIndices.includes(idx)) tile.onclick = () => addWord(idx);
      wordBank.appendChild(tile);
    });
  }

  function renderSentenceBox() {
    sentenceBox.innerHTML = currentSentence.map(w => `<span class="sentence-output-word">${w}</span>`).join(' ');
  }

  function addWord(idx) {
    usedIndices.push(idx);
    currentSentence.push(wordOptions[idx]);
    renderWordBank();
    renderSentenceBox();
  }

  document.getElementById('reset-btn').onclick = () => {
    currentSentence = [];
    usedIndices = [];
    renderWordBank();
    renderSentenceBox();
  };

  document.getElementById('submit-btn').onclick = () => {
      let lives = parseInt(localStorage.getItem('quizLives') || '5');
      let points = parseInt(localStorage.getItem('quizPoints') || '0');

    if (currentSentence.join(' ') === correctSentence.join(' ')) {
      points += 20;
          localStorage.setItem('quizPoints', points);     
      updateStatusBar();
      playPopupAudio("../pass.mp3"); // ‚úÖ correct answer sound
      showPopup("Great job!", "Correct!<br>+20 points", true);
    } else {
      lives = Math.max(0, lives - 1);
        localStorage.setItem('quizLives', lives);
      updateStatusBar();
      playPopupAudio("../fail.mp3"); // ‚ùå wrong answer sound
      if (lives <= 0) {
        showPopup("No lives left!", "Game over.", false, true);
      } else {
        showPopup("Oops!", "That's wrong.<br>-1 life", false);
      }
    }
  };

  function showPopup(title, msg, success, gameOver = false) {
    document.getElementById('popup-zone').innerHTML = `<div class="popup-overlay">
      <div class="popup">
        <h1${success ? '' : " class='wrong'"}>${title}</h1>
        <h2>${msg}</h2>
        ${gameOver 
          ? `<button onclick="window.location.href='../homeSI/index.html'">Go to Home</button>`
          : `<button onclick="continueQuiz()">Continue</button>`}
      </div>
    </div>`;
    document.querySelector('.popup button').focus();
  }

  window.continueQuiz = () => {
    document.getElementById('popup-zone').innerHTML = '';
    window.location.href = 'spanish-intermediate-q4-match.html';
  };

  // üîä Audio play helper
  function playPopupAudio(src) {
    const audio = new Audio(src);
    audio.play().catch(err => {
      console.log("Audio autoplay blocked or failed:", err);
    });
  }

  renderWordBank();
  renderSentenceBox();
</script>
</body>
</html>
